# Supabase Setup Instructions

To make the platform functional, you need to connect it to a Supabase backend.

## 1. Create a Project
1. Go to [supabase.com](https://supabase.com) and sign up.
2. Create a new project.

## 2. Get API Keys
1. In your project dashboard, go to **Project Settings** -> **API**.
2. Copy the `Project URL` and `anon public` key.

## 3. Configure Environment
Create a file named `.env` in the root of your project (`/Users/kwame/Desktop/ticket/.env`) and add these lines:

```env
VITE_SUPABASE_URL=your_project_url_here
VITE_SUPABASE_ANON_KEY=your_anon_key_here
```

## 4. Set up Database Schema
Go to the **SQL Editor** in Supabase and run this complete script to create all necessary tables and policies:

```sql
-- 1. Profiles Table (extends default Auth)
create table profiles (
  id uuid references auth.users not null primary key,
  username text unique,
  full_name text,
  avatar_url text,
  updated_at timestamp with time zone
);

-- 2. Events Table
create table events (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  organizer_id uuid references auth.users not null,
  title text not null,
  date timestamp with time zone not null,
  location text not null,
  description text,
  ticket_price numeric not null,
  image_url text,
  ticket_tiers jsonb default '[]'::jsonb,  -- Stores array of {name, price, features}
  dress_code text                           -- Optional dress code field
);

-- 3. Tickets Table
create table tickets (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  event_title text not null,                -- Currently stores title, could be linked to event.id in future
  ticket_type text not null,
  price numeric not null,
  customer_name text,
  customer_email text,
  customer_phone text,
  payment_reference text,
  status text default 'paid'
);

-- 4. Enable Row Level Security (RLS)
alter table profiles enable row level security;
alter table events enable row level security;
alter table tickets enable row level security;

-- 5. Policies

-- Profiles
create policy "Public profiles are viewable by everyone." 
  on profiles for select using ( true );
create policy "Users can insert their own profile." 
  on profiles for insert with check ( auth.uid() = id );
create policy "Users can update own profile." 
  on profiles for update using ( auth.uid() = id );

-- Events
create policy "Events are viewable by everyone." 
  on events for select using ( true );
create policy "Users can insert their own events." 
  on events for insert with check ( auth.uid() = organizer_id );
create policy "Users can update own events." 
  on events for update using ( auth.uid() = organizer_id );

-- Tickets
-- Allow anyone to buy a ticket (insert)
create policy "Anyone can insert tickets." 
  on tickets for insert with check ( true );

-- (Optional) Policy for users to view tickets linked to their email
-- Note: This requires the user's auth email to match the customer_email
-- create policy "Users can view their own tickets." on tickets for select using ( auth.jwt() ->> 'email' = customer_email );
```
